# 快速开始指南

## 一、安装依赖

```bash
go mod tidy
```

## 二、Native模式（推荐新手）

这是最简单的测试方式，直接通过IP地址连接。

### 步骤1：启动服务端

打开第一个终端，运行：

```bash
go run *.go -mode native
```

你会看到类似输出：
```
Native QUIC Datagram 服务器启动，监听地址: 0.0.0.0:4363
```

### 步骤2：启动客户端

打开第二个终端，运行：

```bash
go run *.go -mode native -server localhost:4363
```

你会看到客户端开始发送数据包，服务端开始接收并显示统计信息。

## 三、LibP2P模式

通过Peer ID建立连接，支持更复杂的网络场景。

### 步骤1：启动服务端

打开第一个终端，运行：

```bash
go run *.go -mode libp2p
```

你会看到类似输出：
```
已加载现有密钥，Peer ID: 12D3KooWExamplePeerID123456789
LibP2P QUIC Datagram 服务器启动
Peer ID: 12D3KooWExamplePeerID123456789
监听地址:
  /ip4/127.0.0.1/udp/4363/quic-v1/p2p/12D3KooWExamplePeerID123456789
  /ip4/192.168.1.100/udp/4363/quic-v1/p2p/12D3KooWExamplePeerID123456789
```

### 步骤2：复制完整地址

从服务端输出中复制完整的multiaddr地址，例如：
```
/ip4/127.0.0.1/udp/4363/quic-v1/p2p/12D3KooWExamplePeerID123456789
```

### 步骤3：启动客户端

打开第二个终端，使用复制的地址运行：

```bash
go run *.go -mode libp2p -peer /ip4/127.0.0.1/udp/4363/quic-v1/p2p/12D3KooWExamplePeerID123456789
```

## 四、自定义测试参数

### 修改包大小

```bash
# 小包测试（64字节）
go run *.go -mode native -server localhost:4363 -size 64

# 大包测试（8192字节）
go run *.go -mode native -server localhost:4363 -size 8192
```

### 修改发送速率

```bash
# 低速测试（10包/秒）
go run *.go -mode native -server localhost:4363 -rate 10

# 高速测试（1000包/秒）
go run *.go -mode native -server localhost:4363 -rate 1000
```

### 修改测试时长

```bash
# 短时测试（10秒）
go run *.go -mode native -server localhost:4363 -duration 10s

# 长时测试（5分钟）
go run *.go -mode native -server localhost:4363 -duration 300s
```

### 组合参数

```bash
# 高频小包测试
go run *.go -mode native -server localhost:4363 -size 64 -rate 1000 -duration 60s

# 大包吞吐量测试
go run *.go -mode native -server localhost:4363 -size 8192 -rate 50 -duration 30s
```

## 五、使用Makefile快捷命令

### 查看所有命令

```bash
make help
```

### Native模式快捷命令

```bash
# 启动服务端
make server-native

# 启动客户端
make client-native

# 小包测试
make test-native-small

# 大包测试
make test-native-large
```

### LibP2P模式快捷命令

```bash
# 启动服务端
make server-libp2p

# 启动客户端（需要指定PEER参数）
make client-libp2p PEER=/ip4/127.0.0.1/udp/4363/quic-v1/p2p/12D3KooW...
```

## 六、查看配置文件

LibP2P模式会在用户目录下创建配置文件：

```bash
# 查看配置目录
ls -la ~/.quic-datagram-test/

# 查看你的Peer ID
cat ~/.quic-datagram-test/peer_id
```

配置文件包括：
- `private_key`: 你的私钥（请妥善保管）
- `peer_id`: 你的Peer ID
- `bootstrap_nodes`: Bootstrap节点列表（可选）

## 七、理解输出结果

### 服务端输出

```
=== 统计信息 ===
接收包数: 3000          # 成功接收的包数
丢失包数: 5             # 检测到的丢包数
丢包率: 0.17%           # 丢包率
平均延迟: 1.234ms       # 平均往返延迟
最小延迟: 0.856ms       # 最小延迟
最大延迟: 5.678ms       # 最大延迟
================
```

### 客户端输出

```
=== 客户端发送统计 ===
发送包数: 3000          # 成功发送的包数
发送错误: 0             # 发送失败的次数
实际发送速率: 99.87 pps # 实际发送速率
总发送时间: 30.039s     # 测试总时长
总数据量: 2.93 MB       # 发送的总数据量
=====================
```

## 八、常见问题

### Q1: 连接失败怎么办？

**Native模式：**
- 确保服务端正在运行
- 检查端口是否被占用：`netstat -an | grep 4363`
- 检查防火墙设置

**LibP2P模式：**
- 确保multiaddr地址完整且正确
- 检查是否包含 `/p2p/` 部分
- 确认网络可达

### Q2: 如何重置配置？

```bash
rm -rf ~/.quic-datagram-test/
# 下次运行时会自动生成新配置
```

### Q3: 如何测试跨主机性能？

**主机A（服务端）：**
```bash
go run *.go -mode native -addr 0.0.0.0:4363
```

**主机B（客户端）：**
```bash
# 替换为主机A的实际IP
go run *.go -mode native -server 192.168.1.100:4363
```

### Q4: 丢包率很高怎么办？

可能原因：
1. 发送速率过高 - 尝试降低 `-rate` 参数
2. 网络拥塞 - 在更好的网络环境测试
3. 系统资源不足 - 关闭其他程序

## 九、更多资源

- 详细使用指南：[USAGE_GUIDE.md](USAGE_GUIDE.md)
- 架构说明：[ARCHITECTURE.md](ARCHITECTURE.md)
- 项目说明：[README.md](README.md)
- 使用示例：运行 `./examples.sh`

## 十、获取帮助

查看所有可用参数：

```bash
go run *.go -h
```

或查看Makefile帮助：

```bash
make help
```

---

祝测试顺利！如有问题，请查看详细文档或提交Issue。
